
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Tripper package">
      
      
      
        <link rel="canonical" href="https://EMMC-ASBL.github.io/tripper/latest/api_reference/mappings/mappings/">
      
      
        <link rel="prev" href="../../backends/sparqlwrapper/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.11">
    
    
      
        <title>mappings - Tripper</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/reference.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mappings" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Tripper" class="md-header__button md-logo" aria-label="Tripper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 9V1.5h-3V9h-3V1.5h-3V9h-3V1.5H4.65V9H3v1.5h18V9h-1.5m0 4.5h-3V21h-3v-7.5h-3V21h-3v-7.5H4.65V21H3v1.5h18V21h-1.5v-7.5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tripper
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              mappings
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/EMMC-ASBL/tripper" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    tripper
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Tripper" class="md-nav__button md-logo" aria-label="Tripper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 9V1.5h-3V9h-3V1.5h-3V9h-3V1.5H4.65V9H3v1.5h18V9h-1.5m0 4.5h-3V21h-3v-7.5h-3V21h-3v-7.5H4.65V21H3v1.5h18V21h-1.5v-7.5Z"/></svg>

    </a>
    Tripper
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EMMC-ASBL/tripper" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    tripper
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../LICENSE/" class="md-nav__link">
        License
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/" class="md-nav__link">
        errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../interface/" class="md-nav__link">
        interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../literal/" class="md-nav__link">
        literal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../namespace/" class="md-nav__link">
        namespace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../triplestore/" class="md-nav__link">
        triplestore
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
      
      
      
        <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
          backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_7">
          <span class="md-nav__icon md-icon"></span>
          backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../backends/collection/" class="md-nav__link">
        collection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../backends/ontopy/" class="md-nav__link">
        ontopy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../backends/rdflib/" class="md-nav__link">
        rdflib
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../backends/sparqlwrapper/" class="md-nav__link">
        sparqlwrapper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
          mappings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5_8">
          <span class="md-nav__icon md-icon"></span>
          mappings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          mappings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        mappings
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings" class="md-nav__link">
    tripper.mappings.mappings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.AmbiguousMappingError" class="md-nav__link">
    AmbiguousMappingError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.InconsistentDimensionError" class="md-nav__link">
    InconsistentDimensionError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.InconsistentTriplesError" class="md-nav__link">
    InconsistentTriplesError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.InsufficientMappingError" class="md-nav__link">
    InsufficientMappingError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingError" class="md-nav__link">
    MappingError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep" class="md-nav__link">
    MappingStep
  </a>
  
    <nav class="md-nav" aria-label="MappingStep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.add_input" class="md-nav__link">
    add_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.add_inputs" class="md-nav__link">
    add_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.get_input_iris" class="md-nav__link">
    get_input_iris()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.get_inputs" class="md-nav__link">
    get_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.join_input" class="md-nav__link">
    join_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.lowest_costs" class="md-nav__link">
    lowest_costs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.number_of_routes" class="md-nav__link">
    number_of_routes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.show" class="md-nav__link">
    show()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.visualise" class="md-nav__link">
    visualise()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MissingRelationError" class="md-nav__link">
    MissingRelationError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.StepType" class="md-nav__link">
    StepType
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.Value" class="md-nav__link">
    Value
  </a>
  
    <nav class="md-nav" aria-label="Value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.Value.show" class="md-nav__link">
    show()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.emmo_mapper" class="md-nav__link">
    emmo_mapper()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.fno_mapper" class="md-nav__link">
    fno_mapper()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.get_nroutes" class="md-nav__link">
    get_nroutes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.get_values" class="md-nav__link">
    get_values()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.mapping_routes" class="md-nav__link">
    mapping_routes()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings" class="md-nav__link">
    tripper.mappings.mappings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.AmbiguousMappingError" class="md-nav__link">
    AmbiguousMappingError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.InconsistentDimensionError" class="md-nav__link">
    InconsistentDimensionError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.InconsistentTriplesError" class="md-nav__link">
    InconsistentTriplesError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.InsufficientMappingError" class="md-nav__link">
    InsufficientMappingError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingError" class="md-nav__link">
    MappingError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep" class="md-nav__link">
    MappingStep
  </a>
  
    <nav class="md-nav" aria-label="MappingStep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.add_input" class="md-nav__link">
    add_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.add_inputs" class="md-nav__link">
    add_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.eval" class="md-nav__link">
    eval()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.get_input_iris" class="md-nav__link">
    get_input_iris()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.get_inputs" class="md-nav__link">
    get_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.join_input" class="md-nav__link">
    join_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.lowest_costs" class="md-nav__link">
    lowest_costs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.number_of_routes" class="md-nav__link">
    number_of_routes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.show" class="md-nav__link">
    show()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MappingStep.visualise" class="md-nav__link">
    visualise()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.MissingRelationError" class="md-nav__link">
    MissingRelationError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.StepType" class="md-nav__link">
    StepType
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.Value" class="md-nav__link">
    Value
  </a>
  
    <nav class="md-nav" aria-label="Value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.Value.show" class="md-nav__link">
    show()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.emmo_mapper" class="md-nav__link">
    emmo_mapper()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.fno_mapper" class="md-nav__link">
    fno_mapper()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.get_nroutes" class="md-nav__link">
    get_nroutes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.get_values" class="md-nav__link">
    get_values()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tripper.mappings.mappings.mapping_routes" class="md-nav__link">
    mapping_routes()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="mappings">mappings<a class="headerlink" href="#mappings" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="tripper.mappings.mappings"></a>
    <div class="doc doc-contents first">

      <p>Implements mappings between entities.</p>
<p>Units are currently handled with pint.Quantity.  The benefit of this
compared to explicit unit conversions, is that units will be handled
transparently by mapping functions, without any need to specify units
of input and output parameters.</p>
<p>Shapes are automatically handled by expressing non-scalar quantities
with numpy.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.AmbiguousMappingError">
        <code>
AmbiguousMappingError            (<a class="autorefs autorefs-internal" title="tripper.mappings.mappings.MappingError" href="#tripper.mappings.mappings.MappingError">MappingError</a>)
        </code>



<a class="headerlink" href="#tripper.mappings.mappings.AmbiguousMappingError" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A property maps to more than one value.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">AmbiguousMappingError</span><span class="p">(</span><span class="n">MappingError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A property maps to more than one value.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.InconsistentDimensionError">
        <code>
InconsistentDimensionError            (<a class="autorefs autorefs-internal" title="tripper.mappings.mappings.MappingError" href="#tripper.mappings.mappings.MappingError">MappingError</a>)
        </code>



<a class="headerlink" href="#tripper.mappings.mappings.InconsistentDimensionError" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>The size of a dimension is assigned to more than one value.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">InconsistentDimensionError</span><span class="p">(</span><span class="n">MappingError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The size of a dimension is assigned to more than one value.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.InconsistentTriplesError">
        <code>
InconsistentTriplesError            (<a class="autorefs autorefs-internal" title="tripper.mappings.mappings.MappingError" href="#tripper.mappings.mappings.MappingError">MappingError</a>)
        </code>



<a class="headerlink" href="#tripper.mappings.mappings.InconsistentTriplesError" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Inconsistcy in RDF triples.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">InconsistentTriplesError</span><span class="p">(</span><span class="n">MappingError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inconsistcy in RDF triples.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.InsufficientMappingError">
        <code>
InsufficientMappingError            (<a class="autorefs autorefs-internal" title="tripper.mappings.mappings.MappingError" href="#tripper.mappings.mappings.MappingError">MappingError</a>)
        </code>



<a class="headerlink" href="#tripper.mappings.mappings.InsufficientMappingError" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>There are properties or dimensions that are not mapped.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">InsufficientMappingError</span><span class="p">(</span><span class="n">MappingError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;There are properties or dimensions that are not mapped.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.MappingError">
        <code>
MappingError            (<span title="Exception">Exception</span>)
        </code>



<a class="headerlink" href="#tripper.mappings.mappings.MappingError" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Base class for mapping errors.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MappingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for mapping errors.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep">
        <code>
MappingStep        </code>



<a class="headerlink" href="#tripper.mappings.mappings.MappingStep" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A step in a mapping route from a target to one or more sources.</p>
<p>A mapping step corresponds to one or more RDF triples.  In the
simple case of a <code>mo:mapsTo</code> or <code>rdfs:isSubclassOf</code> relation, it is
only one triple.  For transformations that has several input and
output, a set of triples are expected.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>output_iri</code></td>
        <td><code>str</code></td>
        <td><p>IRI of the output concept.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>steptype</code></td>
        <td><code>&#39;StepType&#39;</code></td>
        <td><p>One of the step types from the StepType enum.</p></td>
        <td><code>&lt;StepType.UNSPECIFIED: 0&gt;</code></td>
      </tr>
      <tr>
        <td><code>function</code></td>
        <td><code>&#39;Optional[Callable]&#39;</code></td>
        <td><p>Callable that evaluates the output from the input.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cost</code></td>
        <td><code>&#39;Union[float, Callable]&#39;</code></td>
        <td><p>The cost related to this mapping step.  Should be either a
float or a callable taking three arguments (<code>triplestore</code>,
<code>input_iris</code> and <code>output_iri</code>) and return the cost as a float.</p></td>
        <td><code>1.0</code></td>
      </tr>
      <tr>
        <td><code>output_unit</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>Output unit.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>triplestore</code></td>
        <td><code>&#39;Optional[Triplestore]&#39;</code></td>
        <td><p>Triplestore instance containing the knowledge base
that this mapping step was created from.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p>The arguments can also be assigned as attributes.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MappingStep</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A step in a mapping route from a target to one or more sources.</span>

<span class="sd">    A mapping step corresponds to one or more RDF triples.  In the</span>
<span class="sd">    simple case of a `mo:mapsTo` or `rdfs:isSubclassOf` relation, it is</span>
<span class="sd">    only one triple.  For transformations that has several input and</span>
<span class="sd">    output, a set of triples are expected.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        output_iri: IRI of the output concept.</span>
<span class="sd">        steptype: One of the step types from the StepType enum.</span>
<span class="sd">        function: Callable that evaluates the output from the input.</span>
<span class="sd">        cost: The cost related to this mapping step.  Should be either a</span>
<span class="sd">            float or a callable taking three arguments (`triplestore`,</span>
<span class="sd">            `input_iris` and `output_iri`) and return the cost as a float.</span>
<span class="sd">        output_unit: Output unit.</span>
<span class="sd">        triplestore: Triplestore instance containing the knowledge base</span>
<span class="sd">            that this mapping step was created from.</span>

<span class="sd">    The arguments can also be assigned as attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-instance-attributes</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">steptype</span><span class="p">:</span> <span class="s2">&quot;StepType&quot;</span> <span class="o">=</span> <span class="n">StepType</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">,</span>
        <span class="n">function</span><span class="p">:</span> <span class="s2">&quot;Optional[Callable]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cost</span><span class="p">:</span> <span class="s2">&quot;Union[float, Callable]&quot;</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">output_unit</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">triplestore</span><span class="p">:</span> <span class="s2">&quot;Optional[Triplestore]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span> <span class="o">=</span> <span class="n">output_iri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steptype</span> <span class="o">=</span> <span class="n">steptype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span> <span class="o">=</span> <span class="n">triplestore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_unit</span> <span class="o">=</span> <span class="n">output_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span> <span class="s2">&quot;List[dict]&quot;</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of inputs dicts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_mode</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># whether to join upcoming input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span><span class="p">:</span> <span class="s2">&quot;Inputs&quot;</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="s2">&quot;Inputs&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add input dict for an input route.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>  <span class="c1"># nosec B101</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;Input&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an input (MappingStep or Value), where `name` is the name</span>
<span class="sd">        assigned to the argument.</span>

<span class="sd">        If the `join_mode` attribute is false, a new route is created with</span>
<span class="sd">        only one input.</span>

<span class="sd">        If the `join_mode` attribute is true, the input is remembered, but</span>
<span class="sd">        first added when join_input() is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="n">MappingStep</span><span class="p">,</span> <span class="n">Value</span><span class="p">))</span>  <span class="c1"># nosec B101</span>
        <span class="n">argname</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;arg</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span><span class="p">[</span><span class="n">argname</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">({</span><span class="n">argname</span><span class="p">:</span> <span class="nb">input</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">join_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Join all input added with add_input() since `join_mode` was set true.</span>
<span class="sd">        Resets `join_mode` to false.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MappingError</span><span class="p">(</span><span class="s2">&quot;Calling join_input() when join_mode is false.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">routeno</span><span class="p">:</span> <span class="s2">&quot;Optional[int]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">magnitude</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="s2">&quot;Type[Quantity]&quot;</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Any&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the evaluated value of given input route number.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            routeno: The route number to evaluate.  If None (default)</span>
<span class="sd">                the route with the lowest cost is evalueated.</span>
<span class="sd">            unit: return the result in the given unit.</span>
<span class="sd">                Implies `magnitude=True`.</span>
<span class="sd">            magnitude: Whether to only return the magnitude of the evaluated</span>
<span class="sd">                value (with no unit).</span>
<span class="sd">            quantity: Quantity class to use for evaluation.  Defaults to pint.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Evaluation result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">routeno</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">routeno</span><span class="p">),)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowest_costs</span><span class="p">(</span><span class="n">nresults</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">routeno</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">get_values</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">**</span><span class="n">values</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected inputs to be a single argument: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unit</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">m_as</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">magnitude</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">m</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">get_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tuple[Inputs, int]&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns input and input index `(inputs, idx)` for route number</span>
<span class="sd">        `routeno`.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            routeno: The route number to return inputs for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Inputs and difference between route number and number of routes for an</span>
<span class="sd">            input dictioary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
            <span class="n">n0</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">get_nroutes</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">routeno</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">routeno</span> <span class="o">-</span> <span class="n">n0</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;routeno=</span><span class="si">{</span><span class="n">routeno</span><span class="si">}</span><span class="s2"> exceeds number of routes&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_input_iris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dict[str, Optional[str]]&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dict mapping input names to iris for the given route</span>
<span class="sd">        number.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            routeno: The route number to return a mapping for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mapping of input names to IRIs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">routeno</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">output_iri</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">MappingStep</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">output_iri</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">number_of_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total number of routes to this mapping step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Total number of routes to this mapping step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">get_nroutes</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">lowest_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nresults</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;List[Tuple[float, int]]&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of `(cost, routeno)` tuples with up to the `nresult`</span>
<span class="sd">        lowest costs and their corresponding route numbers.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            nresults: Number of results to return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of `(cost, routeno)` tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># total number of routes</span>

        <span class="c1"># Loop over all toplevel routes leading into this mapping step</span>
        <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
            <span class="c1"># For each route, loop over all input arguments of this step</span>
            <span class="c1"># The number of permutations we must consider is the product</span>
            <span class="c1"># of the total number of routes to each input argument.</span>
            <span class="c1">#</span>
            <span class="c1"># We (potentially drastic) limit the possibilities by only</span>
            <span class="c1"># considering the `nresults` routes with lowest costs into</span>
            <span class="c1"># each argument.  This gives at maximum</span>
            <span class="c1">#</span>
            <span class="c1">#     nresults * number_of_input_arguments</span>
            <span class="c1">#</span>
            <span class="c1"># possibilities. We calculate the costs for all of them and</span>
            <span class="c1"># store them in an array with two columns: `cost` and `routeno`.</span>
            <span class="c1"># The `results` list is extended with the cost array</span>
            <span class="c1"># for each toplevel route leading into this step.</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">([(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;cost,routeno&quot;</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s2">&quot;f8,i8&quot;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">MappingStep</span><span class="p">):</span>
                    <span class="n">nroutes</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">number_of_routes</span><span class="p">()</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span>
                            <span class="nb">input</span><span class="o">.</span><span class="n">lowest_costs</span><span class="p">(</span><span class="n">nresults</span><span class="o">=</span><span class="n">nresults</span><span class="p">),</span>
                            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="p">),</span>
                        <span class="c1"># [</span>
                        <span class="c1">#     row</span>
                        <span class="c1">#     for row in sorted(</span>
                        <span class="c1">#         input.lowest_costs(nresults=nresults),</span>
                        <span class="c1">#         key=lambda x: x[1],</span>
                        <span class="c1">#     )</span>
                        <span class="c1"># ],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">res1</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
                    <span class="n">base</span><span class="o">.</span><span class="n">cost</span> <span class="o">+=</span> <span class="n">res1</span><span class="o">.</span><span class="n">cost</span>
                    <span class="n">base</span><span class="o">.</span><span class="n">routeno</span> <span class="o">+=</span> <span class="n">res1</span><span class="o">.</span><span class="n">routeno</span> <span class="o">*</span> <span class="n">m</span>
                    <span class="n">m</span> <span class="o">*=</span> <span class="n">nroutes</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base</span><span class="o">.</span><span class="n">cost</span> <span class="o">+=</span> <span class="nb">input</span><span class="o">.</span><span class="n">cost</span>

            <span class="c1"># Reduce the length of base (makes probably only sense in</span>
            <span class="c1"># the case self.cost is a callable, but it doesn&#39;t hurt...)</span>
            <span class="n">base</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="n">nresults</span><span class="p">]</span>
            <span class="n">base</span><span class="o">.</span><span class="n">routeno</span> <span class="o">+=</span> <span class="n">n</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">m</span>

            <span class="c1"># Add the cost for this step to `res`.  If `self.cost` is</span>
            <span class="c1"># a callable, we call it with the input for each routeno</span>
            <span class="c1"># as arguments.  Otherwise `self.cost` is the cost of this</span>
            <span class="c1"># mapping step.</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rno</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">routeno</span><span class="p">):</span>
                    <span class="n">inputs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">rno</span><span class="p">)</span>
                    <span class="n">input_iris</span> <span class="o">=</span> <span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">output_iri</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                    <span class="n">owncost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span><span class="p">,</span> <span class="n">input_iris</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="p">)</span>
                    <span class="n">base</span><span class="o">.</span><span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">owncost</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">owncost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span>
                <span class="n">base</span><span class="o">.</span><span class="n">cost</span> <span class="o">+=</span> <span class="n">owncost</span>

            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="c1"># Finally sort the results according to cost and return the</span>
        <span class="c1"># `nresults` rows with lowest cost.</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="p">)[:</span><span class="n">nresults</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">routeno</span><span class="p">:</span> <span class="s2">&quot;Optional[int]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a string representation of the mapping routes to this step.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            routeno: show given route.  The default is to show all routes.</span>
<span class="sd">            name: Name of the last mapping step (mainly for internal use).</span>
<span class="sd">            indent: How of blanks to prepend each line with (mainly for</span>
<span class="sd">                internal use).</span>

<span class="sd">        Returns:</span>
<span class="sd">            String representation of the mapping routes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;Step&quot;</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  steptype: &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steptype</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">steptype</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  output_iri: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  output_unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  cost: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">routeno</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;  routes:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">input_</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">input_</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;    - &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span> <span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;  inputs:&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">routeno</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">input_</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">routeno</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">input_</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;    - &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span> <span class="p">:])</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Help method that returns prefixed iri if possible, otherwise `iri`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span><span class="o">.</span><span class="n">prefix_iri</span><span class="p">(</span><span class="n">iri</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span> <span class="k">else</span> <span class="n">iri</span>

    <span class="k">def</span> <span class="nf">_visualise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">next_iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">next_steptype</span><span class="p">:</span> <span class="n">StepType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Help function for visualise().</span>

<span class="sd">        Arguments:</span>
<span class="sd">            routeno: Route number to visualise.</span>
<span class="sd">            next_iri: IRI of the next mapping step (i.e. the previous mapping</span>
<span class="sd">                when starting from the target).</span>
<span class="sd">            next_steptype: Step type from this to next iri.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Mapping route in dot (graphviz) notation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hasOutput</span> <span class="o">=</span> <span class="n">EMMO</span><span class="o">.</span><span class="n">EMMO_c4bace1d_4db0_4cd3_87e9_18122bae2840</span>

        <span class="c1"># Edge labels. We invert the steptypes, since we want to visualise</span>
        <span class="c1"># the workflow in forward direction, while the steptypes refer to</span>
        <span class="c1"># backward direction</span>
        <span class="n">labeldict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">MAPSTO</span><span class="p">:</span> <span class="s2">&quot;inverse(mapsTo)&quot;</span><span class="p">,</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">INV_MAPSTO</span><span class="p">:</span> <span class="s2">&quot;mapsTo&quot;</span><span class="p">,</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">INSTANCEOF</span><span class="p">:</span> <span class="s2">&quot;instanceOf&quot;</span><span class="p">,</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">INV_INSTANCEOF</span><span class="p">:</span> <span class="s2">&quot;inverse(instanceOf)&quot;</span><span class="p">,</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">SUBCLASSOF</span><span class="p">:</span> <span class="s2">&quot;subClassOf&quot;</span><span class="p">,</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">INV_SUBCLASSOF</span><span class="p">:</span> <span class="s2">&quot;inverse(subClassOf)&quot;</span><span class="p">,</span>
            <span class="n">StepType</span><span class="o">.</span><span class="n">FUNCTION</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">routeno</span><span class="p">)</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
                <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;  &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_iri</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">output_iri</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; -&gt; &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_iri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;[label=&quot;</span><span class="si">{</span><span class="n">labeldict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">steptype</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;];&#39;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">MappingStep</span><span class="p">):</span>
                <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">input</span><span class="o">.</span><span class="n">_visualise</span><span class="p">(</span>  <span class="c1"># pylint: disable=protected-access</span>
                        <span class="n">routeno</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
                        <span class="n">next_iri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="p">,</span>
                        <span class="n">next_steptype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steptype</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input should be Value or MappingStep&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">next_iri</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">labeldict</span><span class="p">[</span><span class="n">next_steptype</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">next_steptype</span> <span class="o">==</span> <span class="n">StepType</span><span class="o">.</span><span class="n">FUNCTION</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span><span class="p">:</span>
                <span class="n">model_iri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span><span class="o">.</span><span class="n">value</span><span class="p">(</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">hasOutput</span><span class="p">,</span>  <span class="c1"># Assuming EMMO</span>
                    <span class="nb">object</span><span class="o">=</span><span class="n">next_iri</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
                    <span class="nb">any</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">model_iri</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span><span class="o">.</span><span class="n">value</span><span class="p">(</span>
                        <span class="n">subject</span><span class="o">=</span><span class="n">model_iri</span><span class="p">,</span>
                        <span class="n">predicate</span><span class="o">=</span><span class="n">RDFS</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_iri</span><span class="p">(</span><span class="n">model_iri</span><span class="p">),</span>
                        <span class="nb">any</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">labeldict</span><span class="p">[</span><span class="n">next_steptype</span><span class="p">]</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;  &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_iri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; -&gt; &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_iri</span><span class="p">(</span><span class="n">next_iri</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; [label=&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&quot;];&#39;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualise</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span><span class="p">,</span>
        <span class="n">dot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dot&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Greate a Graphviz visualisation of a given mapping route.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            routeno: Number of mapping route to visualise.</span>
<span class="sd">            output: If given, write the graph to this file.</span>
<span class="sd">            format: File format to use with `output`.</span>
<span class="sd">            dot: Path to Graphviz dot executable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            String representation of the graph in dot format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;digraph G {&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_visualise</span><span class="p">(</span><span class="n">routeno</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">StepType</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">dot</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;-T</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">],</span>
                <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># nosec: B603</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="nb">input</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.add_input">
<code class="highlight language-python"><span class="n">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.add_input" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add an input (MappingStep or Value), where <code>name</code> is the name
assigned to the argument.</p>
<p>If the <code>join_mode</code> attribute is false, a new route is created with
only one input.</p>
<p>If the <code>join_mode</code> attribute is true, the input is remembered, but
first added when join_input() is called.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;Input&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an input (MappingStep or Value), where `name` is the name</span>
<span class="sd">    assigned to the argument.</span>

<span class="sd">    If the `join_mode` attribute is false, a new route is created with</span>
<span class="sd">    only one input.</span>

<span class="sd">    If the `join_mode` attribute is true, the input is remembered, but</span>
<span class="sd">    first added when join_input() is called.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="n">MappingStep</span><span class="p">,</span> <span class="n">Value</span><span class="p">))</span>  <span class="c1"># nosec B101</span>
    <span class="n">argname</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;arg</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_mode</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span><span class="p">[</span><span class="n">argname</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">({</span><span class="n">argname</span><span class="p">:</span> <span class="nb">input</span><span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.add_inputs">
<code class="highlight language-python"><span class="n">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.add_inputs" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add input dict for an input route.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="s2">&quot;Inputs&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add input dict for an input route.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>  <span class="c1"># nosec B101</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.eval">
<code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pint</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="s1">&#39;&gt;)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.eval" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns the evaluated value of given input route number.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>routeno</code></td>
        <td><code>&#39;Optional[int]&#39;</code></td>
        <td><p>The route number to evaluate.  If None (default)
the route with the lowest cost is evalueated.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unit</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>return the result in the given unit.
Implies <code>magnitude=True</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>magnitude</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to only return the magnitude of the evaluated
value (with no unit).</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>quantity</code></td>
        <td><code>&#39;Type[Quantity]&#39;</code></td>
        <td><p>Quantity class to use for evaluation.  Defaults to pint.</p></td>
        <td><code>&lt;class &#39;pint.quantity.Quantity&#39;&gt;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&#39;Any&#39;</code></td>
      <td><p>Evaluation result.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">routeno</span><span class="p">:</span> <span class="s2">&quot;Optional[int]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">magnitude</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">quantity</span><span class="p">:</span> <span class="s2">&quot;Type[Quantity]&quot;</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Any&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the evaluated value of given input route number.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        routeno: The route number to evaluate.  If None (default)</span>
<span class="sd">            the route with the lowest cost is evalueated.</span>
<span class="sd">        unit: return the result in the given unit.</span>
<span class="sd">            Implies `magnitude=True`.</span>
<span class="sd">        magnitude: Whether to only return the magnitude of the evaluated</span>
<span class="sd">            value (with no unit).</span>
<span class="sd">        quantity: Quantity class to use for evaluation.  Defaults to pint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Evaluation result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">routeno</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">routeno</span><span class="p">),)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowest_costs</span><span class="p">(</span><span class="n">nresults</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">inputs</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">routeno</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">get_values</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">**</span><span class="n">values</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected inputs to be a single argument: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unit</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">m_as</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">magnitude</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">m</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.get_input_iris">
<code class="highlight language-python"><span class="n">get_input_iris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.get_input_iris" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns a dict mapping input names to iris for the given route
number.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>routeno</code></td>
        <td><code>int</code></td>
        <td><p>The route number to return a mapping for.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&#39;Dict[str, Optional[str]]&#39;</code></td>
      <td><p>Mapping of input names to IRIs.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_input_iris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dict[str, Optional[str]]&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dict mapping input names to iris for the given route</span>
<span class="sd">    number.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        routeno: The route number to return a mapping for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Mapping of input names to IRIs.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inputs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">routeno</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">output_iri</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">MappingStep</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">output_iri</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.get_inputs">
<code class="highlight language-python"><span class="n">get_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.get_inputs" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns input and input index <code>(inputs, idx)</code> for route number
<code>routeno</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>routeno</code></td>
        <td><code>int</code></td>
        <td><p>The route number to return inputs for.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&#39;Tuple[Inputs, int]&#39;</code></td>
      <td><p>Inputs and difference between route number and number of routes for an
input dictioary.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tuple[Inputs, int]&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns input and input index `(inputs, idx)` for route number</span>
<span class="sd">    `routeno`.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        routeno: The route number to return inputs for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Inputs and difference between route number and number of routes for an</span>
<span class="sd">        input dictioary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
        <span class="n">n0</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="n">get_nroutes</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">routeno</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">routeno</span> <span class="o">-</span> <span class="n">n0</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;routeno=</span><span class="si">{</span><span class="n">routeno</span><span class="si">}</span><span class="s2"> exceeds number of routes&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.join_input">
<code class="highlight language-python"><span class="n">join_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.join_input" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Join all input added with add_input() since <code>join_mode</code> was set true.
Resets <code>join_mode</code> to false.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">join_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Join all input added with add_input() since `join_mode` was set true.</span>
<span class="sd">    Resets `join_mode` to false.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_mode</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MappingError</span><span class="p">(</span><span class="s2">&quot;Calling join_input() when join_mode is false.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">join_mode</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">joined_input</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.lowest_costs">
<code class="highlight language-python"><span class="n">lowest_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nresults</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.lowest_costs" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns a list of <code>(cost, routeno)</code> tuples with up to the <code>nresult</code>
lowest costs and their corresponding route numbers.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>nresults</code></td>
        <td><code>int</code></td>
        <td><p>Number of results to return.</p></td>
        <td><code>5</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&#39;List[Tuple[float, int]]&#39;</code></td>
      <td><p>A list of <code>(cost, routeno)</code> tuples.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">lowest_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nresults</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;List[Tuple[float, int]]&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of `(cost, routeno)` tuples with up to the `nresult`</span>
<span class="sd">    lowest costs and their corresponding route numbers.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        nresults: Number of results to return.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of `(cost, routeno)` tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># total number of routes</span>

    <span class="c1"># Loop over all toplevel routes leading into this mapping step</span>
    <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
        <span class="c1"># For each route, loop over all input arguments of this step</span>
        <span class="c1"># The number of permutations we must consider is the product</span>
        <span class="c1"># of the total number of routes to each input argument.</span>
        <span class="c1">#</span>
        <span class="c1"># We (potentially drastic) limit the possibilities by only</span>
        <span class="c1"># considering the `nresults` routes with lowest costs into</span>
        <span class="c1"># each argument.  This gives at maximum</span>
        <span class="c1">#</span>
        <span class="c1">#     nresults * number_of_input_arguments</span>
        <span class="c1">#</span>
        <span class="c1"># possibilities. We calculate the costs for all of them and</span>
        <span class="c1"># store them in an array with two columns: `cost` and `routeno`.</span>
        <span class="c1"># The `results` list is extended with the cost array</span>
        <span class="c1"># for each toplevel route leading into this step.</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">([(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;cost,routeno&quot;</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s2">&quot;f8,i8&quot;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">MappingStep</span><span class="p">):</span>
                <span class="n">nroutes</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">number_of_routes</span><span class="p">()</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">(</span>
                    <span class="nb">sorted</span><span class="p">(</span>
                        <span class="nb">input</span><span class="o">.</span><span class="n">lowest_costs</span><span class="p">(</span><span class="n">nresults</span><span class="o">=</span><span class="n">nresults</span><span class="p">),</span>
                        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">),</span>
                    <span class="c1"># [</span>
                    <span class="c1">#     row</span>
                    <span class="c1">#     for row in sorted(</span>
                    <span class="c1">#         input.lowest_costs(nresults=nresults),</span>
                    <span class="c1">#         key=lambda x: x[1],</span>
                    <span class="c1">#     )</span>
                    <span class="c1"># ],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">res1</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">base</span><span class="p">))</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
                <span class="n">base</span><span class="o">.</span><span class="n">cost</span> <span class="o">+=</span> <span class="n">res1</span><span class="o">.</span><span class="n">cost</span>
                <span class="n">base</span><span class="o">.</span><span class="n">routeno</span> <span class="o">+=</span> <span class="n">res1</span><span class="o">.</span><span class="n">routeno</span> <span class="o">*</span> <span class="n">m</span>
                <span class="n">m</span> <span class="o">*=</span> <span class="n">nroutes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base</span><span class="o">.</span><span class="n">cost</span> <span class="o">+=</span> <span class="nb">input</span><span class="o">.</span><span class="n">cost</span>

        <span class="c1"># Reduce the length of base (makes probably only sense in</span>
        <span class="c1"># the case self.cost is a callable, but it doesn&#39;t hurt...)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="n">nresults</span><span class="p">]</span>
        <span class="n">base</span><span class="o">.</span><span class="n">routeno</span> <span class="o">+=</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="n">m</span>

        <span class="c1"># Add the cost for this step to `res`.  If `self.cost` is</span>
        <span class="c1"># a callable, we call it with the input for each routeno</span>
        <span class="c1"># as arguments.  Otherwise `self.cost` is the cost of this</span>
        <span class="c1"># mapping step.</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rno</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">routeno</span><span class="p">):</span>
                <span class="n">inputs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">rno</span><span class="p">)</span>
                <span class="n">input_iris</span> <span class="o">=</span> <span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">output_iri</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                <span class="n">owncost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triplestore</span><span class="p">,</span> <span class="n">input_iris</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="p">)</span>
                <span class="n">base</span><span class="o">.</span><span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">owncost</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">owncost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cost</span>
            <span class="n">base</span><span class="o">.</span><span class="n">cost</span> <span class="o">+=</span> <span class="n">owncost</span>

        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># Finally sort the results according to cost and return the</span>
    <span class="c1"># `nresults` rows with lowest cost.</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="p">)[:</span><span class="n">nresults</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.number_of_routes">
<code class="highlight language-python"><span class="n">number_of_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.number_of_routes" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Total number of routes to this mapping step.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>int</code></td>
      <td><p>Total number of routes to this mapping step.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">number_of_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Total number of routes to this mapping step.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Total number of routes to this mapping step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="n">get_nroutes</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.show">
<code class="highlight language-python"><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.show" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns a string representation of the mapping routes to this step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>routeno</code></td>
        <td><code>&#39;Optional[int]&#39;</code></td>
        <td><p>show given route.  The default is to show all routes.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>Name of the last mapping step (mainly for internal use).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>int</code></td>
        <td><p>How of blanks to prepend each line with (mainly for
internal use).</p></td>
        <td><code>0</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>String representation of the mapping routes.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">show</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">routeno</span><span class="p">:</span> <span class="s2">&quot;Optional[int]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a string representation of the mapping routes to this step.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        routeno: show given route.  The default is to show all routes.</span>
<span class="sd">        name: Name of the last mapping step (mainly for internal use).</span>
<span class="sd">        indent: How of blanks to prepend each line with (mainly for</span>
<span class="sd">            internal use).</span>

<span class="sd">    Returns:</span>
<span class="sd">        String representation of the mapping routes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;Step&quot;</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  steptype: &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steptype</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">steptype</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  output_iri: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  output_unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  cost: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">routeno</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;  routes:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_routes</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">input_</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">input_</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;    - &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span> <span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;  inputs:&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">(</span><span class="n">routeno</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">input_</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">routeno</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">input_</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="s2">&quot;    - &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">6</span> <span class="p">:])</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.MappingStep.visualise">
<code class="highlight language-python"><span class="n">visualise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dot</span><span class="o">=</span><span class="s1">&#39;dot&#39;</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.MappingStep.visualise" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Greate a Graphviz visualisation of a given mapping route.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>routeno</code></td>
        <td><code>int</code></td>
        <td><p>Number of mapping route to visualise.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>If given, write the graph to this file.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>format</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>File format to use with <code>output</code>.</p></td>
        <td><code>&#39;png&#39;</code></td>
      </tr>
      <tr>
        <td><code>dot</code></td>
        <td><code>str</code></td>
        <td><p>Path to Graphviz dot executable.</p></td>
        <td><code>&#39;dot&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>String representation of the graph in dot format.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visualise</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">format</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span><span class="p">,</span>
    <span class="n">dot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dot&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Greate a Graphviz visualisation of a given mapping route.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        routeno: Number of mapping route to visualise.</span>
<span class="sd">        output: If given, write the graph to this file.</span>
<span class="sd">        format: File format to use with `output`.</span>
<span class="sd">        dot: Path to Graphviz dot executable.</span>

<span class="sd">    Returns:</span>
<span class="sd">        String representation of the graph in dot format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;digraph G {&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_visualise</span><span class="p">(</span><span class="n">routeno</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">StepType</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">))</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">dot</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;-T</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">],</span>
            <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># nosec: B603</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.MissingRelationError">
        <code>
MissingRelationError            (<a class="autorefs autorefs-internal" title="tripper.mappings.mappings.MappingError" href="#tripper.mappings.mappings.MappingError">MappingError</a>)
        </code>



<a class="headerlink" href="#tripper.mappings.mappings.MissingRelationError" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>There are missing relations in RDF triples.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MissingRelationError</span><span class="p">(</span><span class="n">MappingError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;There are missing relations in RDF triples.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.StepType">
        <code>
StepType            (<span title="enum.Enum">Enum</span>)
        </code>



<a class="headerlink" href="#tripper.mappings.mappings.StepType" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Type of mapping step when going from the output to the inputs.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StepType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Type of mapping step when going from the output to the inputs.&quot;&quot;&quot;</span>

    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">MAPSTO</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">INV_MAPSTO</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">INSTANCEOF</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">INV_INSTANCEOF</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
    <span class="n">SUBCLASSOF</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">INV_SUBCLASSOF</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="mi">4</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.Value">
        <code>
Value        </code>



<a class="headerlink" href="#tripper.mappings.mappings.Value" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Represents the value of an instance property.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value</code></td>
        <td><code>&#39;Any&#39;</code></td>
        <td><p>Property value.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unit</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>Property unit.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>iri</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>IRI of ontological concept that this value is an instance of.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>property_iri</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>IRI of datamodel property that this value is an
instance of.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cost</code></td>
        <td><code>&#39;Union[float, Callable]&#39;</code></td>
        <td><p>Cost of accessing this value.</p></td>
        <td><code>0.0</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Value</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the value of an instance property.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        value: Property value.</span>
<span class="sd">        unit: Property unit.</span>
<span class="sd">        iri: IRI of ontological concept that this value is an instance of.</span>
<span class="sd">        property_iri: IRI of datamodel property that this value is an</span>
<span class="sd">            instance of.</span>
<span class="sd">        cost: Cost of accessing this value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-few-public-methods</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;Any&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">iri</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">property_iri</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cost</span><span class="p">:</span> <span class="s2">&quot;Union[float, Callable]&quot;</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="k">if</span> <span class="n">iri</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span> <span class="o">=</span> <span class="n">iri</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_:value_</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_iri</span> <span class="o">=</span> <span class="n">property_iri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">cost</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">routeno</span><span class="p">:</span> <span class="s2">&quot;Optional[int]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># pylint: disable=unused-argument</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a string representation of the Value.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            routeno: Unused.  The argument exists for consistency with</span>
<span class="sd">                the corresponding method in Step.</span>
<span class="sd">            name: Name of value.</span>
<span class="sd">            indent: Indentation level.</span>

<span class="sd">        Returns:</span>
<span class="sd">            String representation of the value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;Value&quot;</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  iri: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  property_iri: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">property_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  cost: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  value: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="tripper.mappings.mappings.Value.show">
<code class="highlight language-python"><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routeno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.Value.show" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns a string representation of the Value.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>routeno</code></td>
        <td><code>&#39;Optional[int]&#39;</code></td>
        <td><p>Unused.  The argument exists for consistency with
the corresponding method in Step.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>&#39;Optional[str]&#39;</code></td>
        <td><p>Name of value.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>int</code></td>
        <td><p>Indentation level.</p></td>
        <td><code>0</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>String representation of the value.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">show</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">routeno</span><span class="p">:</span> <span class="s2">&quot;Optional[int]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Optional[str]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># pylint: disable=unused-argument</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a string representation of the Value.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        routeno: Unused.  The argument exists for consistency with</span>
<span class="sd">            the corresponding method in Step.</span>
<span class="sd">        name: Name of value.</span>
<span class="sd">        indent: Indentation level.</span>

<span class="sd">    Returns:</span>
<span class="sd">        String representation of the value.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;Value&quot;</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  iri: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  property_iri: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">property_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  cost: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;  value: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.emmo_mapper">
<code class="highlight language-python"><span class="n">emmo_mapper</span><span class="p">(</span><span class="n">triplestore</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.emmo_mapper" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Finds all function definitions in <code>triplestore</code> based on EMMO.</p>
<p>Return a dict mapping output IRIs to a list of</p>
<div class="highlight"><pre><span></span><code>(function_iri, [input_iris, ...])
</code></pre></div>
<p>tuples.</p>

        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">emmo_mapper</span><span class="p">(</span><span class="n">triplestore</span><span class="p">:</span> <span class="s2">&quot;Triplestore&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dict[str, list]&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds all function definitions in `triplestore` based on EMMO.</span>

<span class="sd">    Return a dict mapping output IRIs to a list of</span>

<span class="sd">        (function_iri, [input_iris, ...])</span>

<span class="sd">    tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Task</span> <span class="o">=</span> <span class="n">EMMO</span><span class="o">.</span><span class="n">EMMO_4299e344_a321_4ef2_a744_bacfcce80afc</span>
    <span class="n">hasInput</span> <span class="o">=</span> <span class="n">EMMO</span><span class="o">.</span><span class="n">EMMO_36e69413_8c59_4799_946c_10b05d266e22</span>
    <span class="n">hasOutput</span> <span class="o">=</span> <span class="n">EMMO</span><span class="o">.</span><span class="n">EMMO_c4bace1d_4db0_4cd3_87e9_18122bae2840</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span><span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">Task</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">triplestore</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">hasInput</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">hasOutput</span><span class="p">):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">output</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">task</span><span class="p">,</span> <span class="n">inputs</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">d</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.fno_mapper">
<code class="highlight language-python"><span class="n">fno_mapper</span><span class="p">(</span><span class="n">triplestore</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.fno_mapper" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Finds all function definitions in <code>triplestore</code> based on the function
ontololy (FNO).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>triplestore</code></td>
        <td><code>&#39;Triplestore&#39;</code></td>
        <td><p>The triplestore to investigate.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&#39;Dict[str, list]&#39;</code></td>
      <td><p>A mapping of output IRIs to a list of <code>(function_iri, [input_iris, ...])</code>
tuples.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fno_mapper</span><span class="p">(</span><span class="n">triplestore</span><span class="p">:</span> <span class="s2">&quot;Triplestore&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dict[str, list]&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds all function definitions in `triplestore` based on the function</span>
<span class="sd">    ontololy (FNO).</span>

<span class="sd">    Arguments:</span>
<span class="sd">        triplestore: The triplestore to investigate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A mapping of output IRIs to a list of `(function_iri, [input_iris, ...])`</span>
<span class="sd">        tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=too-many-branches</span>

    <span class="c1"># Temporary dicts for fast lookup</span>
    <span class="n">Dfirst</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">RDF</span><span class="o">.</span><span class="n">first</span><span class="p">))</span>
    <span class="n">Drest</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">RDF</span><span class="o">.</span><span class="n">rest</span><span class="p">))</span>
    <span class="n">Dexpects</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">Dreturns</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">FNO</span><span class="o">.</span><span class="n">expects</span><span class="p">):</span>
        <span class="n">Dexpects</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">FNO</span><span class="o">.</span><span class="n">returns</span><span class="p">):</span>
        <span class="n">Dreturns</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">Dreturns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">input_iris</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">Dexpects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">()):</span>
            <span class="k">if</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">Dfirst</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">Dfirst</span><span class="p">:</span>
                    <span class="n">input_iris</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dfirst</span><span class="p">[</span><span class="n">exp</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">exp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Drest</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">exp</span> <span class="o">=</span> <span class="n">Drest</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Support also misuse of FNO, where fno:expects refers</span>
                <span class="c1"># directly to input individuals</span>
                <span class="n">input_iris</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">Dfirst</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">Dfirst</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">Dfirst</span><span class="p">[</span><span class="n">ret</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">input_iris</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">ret</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Drest</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">Drest</span><span class="p">[</span><span class="n">ret</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Support also misuse of FNO, where fno:returns refers</span>
                <span class="c1"># directly to the returned individual</span>
                <span class="n">d</span><span class="p">[</span><span class="n">ret</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">input_iris</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">d</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.get_nroutes">
<code class="highlight language-python"><span class="n">get_nroutes</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.get_nroutes" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Help function returning the number of routes for an input dict.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>inputs</code></td>
        <td><code>&#39;Inputs&#39;</code></td>
        <td><p>Input dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>int</code></td>
      <td><p>Number of routes in the <code>inputs</code> input dictionary.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_nroutes</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="s2">&quot;Inputs&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Help function returning the number of routes for an input dict.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        inputs: Input dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of routes in the `inputs` input dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nroutes</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">MappingStep</span><span class="p">):</span>
            <span class="n">nroutes</span> <span class="o">*=</span> <span class="nb">input</span><span class="o">.</span><span class="n">number_of_routes</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nroutes</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.get_values">
<code class="highlight language-python"><span class="n">get_values</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">routeno</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pint</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="s1">&#39;&gt;, magnitudes=False)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.get_values" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Help function returning a dict mapping the input names to actual value
of expected input unit.</p>
<p>There exists <code>get_nroutes(inputs)</code> routes to populate <code>inputs</code>.
<code>routeno</code> is the index of the specific route we will use to obtain the
values.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>inputs</code></td>
        <td><code>&#39;dict[str, Any]&#39;</code></td>
        <td><p>Input dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>routeno</code></td>
        <td><code>int</code></td>
        <td><p>Route number index.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>quantity</code></td>
        <td><code>&#39;Type[Quantity]&#39;</code></td>
        <td><p>A unit quantity class.</p></td>
        <td><code>&lt;class &#39;pint.quantity.Quantity&#39;&gt;</code></td>
      </tr>
      <tr>
        <td><code>magnitudes</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to only return the magnitude of the evaluated
value (with no unit).</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&#39;dict[str, Any]&#39;</code></td>
      <td><p>A mapping between input names and values of expected input unit.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="s2">&quot;dict[str, Any]&quot;</span><span class="p">,</span>
    <span class="n">routeno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">quantity</span><span class="p">:</span> <span class="s2">&quot;Type[Quantity]&quot;</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">,</span>
    <span class="n">magnitudes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;dict[str, Any]&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Help function returning a dict mapping the input names to actual value</span>
<span class="sd">    of expected input unit.</span>

<span class="sd">    There exists `get_nroutes(inputs)` routes to populate `inputs`.</span>
<span class="sd">    `routeno` is the index of the specific route we will use to obtain the</span>
<span class="sd">    values.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        inputs: Input dictionary.</span>
<span class="sd">        routeno: Route number index.</span>
<span class="sd">        quantity: A unit quantity class.</span>
<span class="sd">        magnitudes: Whether to only return the magnitude of the evaluated</span>
<span class="sd">            value (with no unit).</span>

<span class="sd">    Returns:</span>
<span class="sd">        A mapping between input names and values of expected input unit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">MappingStep</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">routeno</span><span class="o">=</span><span class="n">routeno</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">value</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">output_unit</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">output_unit</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">value</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
            <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">quantity</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Expected values in inputs to be either `MappingStep` or &quot;</span>
                <span class="s2">&quot;`Value` objects.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">magnitudes</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">m</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="tripper.mappings.mappings.mapping_routes">
<code class="highlight language-python"><span class="n">mapping_routes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">triplestore</span><span class="p">,</span> <span class="n">function_repo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">function_mappers</span><span class="o">=</span><span class="p">(</span><span class="o">&lt;</span><span class="n">function</span> <span class="n">emmo_mapper</span> <span class="n">at</span> <span class="mh">0x7f53ea70ed40</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">fno_mapper</span> <span class="n">at</span> <span class="mh">0x7f53ea70edd0</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">default_costs</span><span class="o">=</span><span class="p">((</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;mapsTo&#39;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;instanceOf&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;subClassOf&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span> <span class="n">value_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mappingstep_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mapsTo</span><span class="o">=</span><span class="s1">&#39;http://emmo.info/domain-mappings#mapsTo&#39;</span><span class="p">,</span> <span class="n">instanceOf</span><span class="o">=</span><span class="s1">&#39;http://emmo.info/datamodel#instanceOf&#39;</span><span class="p">,</span> <span class="n">subClassOf</span><span class="o">=</span><span class="s1">&#39;http://www.w3.org/2000/01/rdf-schema#subClassOf&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;http://www.w3.org/2000/01/rdf-schema#label&#39;</span><span class="p">,</span> <span class="n">hasUnit</span><span class="o">=</span><span class="s1">&#39;http://emmo.info/datamodel#hasUnit&#39;</span><span class="p">,</span> <span class="n">hasCost</span><span class="o">=</span><span class="s1">&#39;http://emmo.info/datamodel#hasCost&#39;</span><span class="p">)</span></code>


<a class="headerlink" href="#tripper.mappings.mappings.mapping_routes" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Find routes of mappings from any source in <code>sources</code> to <code>target</code>.</p>
<p>This implementation supports functions (using FnO) and subclass
relations.  It also correctly handles transitivity of <code>mapsTo</code> and
<code>subClassOf</code> relations.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>target</code></td>
        <td><code>str</code></td>
        <td><p>IRI of the target in <code>triplestore</code>.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>sources</code></td>
        <td><code>&#39;Union[Dict[str, Union[None, Value]], Sequence[str]]&#39;</code></td>
        <td><p>Dict mapping source IRIs to source values or a sequence
of source IRIs (with no explicit values).</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>triplestore</code></td>
        <td><code>&#39;Triplestore&#39;</code></td>
        <td><p>Triplestore instance.
It is safe to pass a generator expression too.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>      <p>Additional arguments for fine-grained tuning:
    !!! function_repo "Dict mapping function IRIs to corresponding Python"
        function.  Default is to use <code>triplestore.function_repo</code>.
    !!! function_mappers "Name of mapping standard: "emmo" or "fno"."
        Alternatively, a sequence of mapping functions that takes
        <code>triplestore</code> as argument and return a dict mapping output IRIs
        to a list of <code>(function_iri, [input_iris, ...])</code> tuples.
    !!! default_costs "A dict providing default costs of different types"
        of mapping steps ("function", "mapsTo", "instanceOf",
        "subclassOf", and "value").  These costs can be overridden with
        'hasCost' relations in the ontology.
    !!! value_class "Optional <code>Value</code> subclass to use instead of <code>Value</code> when"
        creating the returned mapping route.
    !!! mappingstep_class "Optional <code>MappingStep</code> subclass to use instead of"
        <code>MappingStep</code> when creating the returned mapping route.
    mapsTo: IRI of 'mapsTo' in <code>triplestore</code>.
    instanceOf: IRI of 'instanceOf' in <code>triplestore</code>.
    !!! subclassof "IRI of 'subClassOf' in <code>triples</code>.  Set it to None if"
        subclasses should not be considered.
    !!! label "IRI of 'label' in <code>triplestore</code>.  Used for naming function"
        input parameters.  The default is to use rdfs:label.
    !!! hasunit "IRI of 'hasUnit' in <code>triples</code>.  Can be used to explicit"
        specify the unit of a quantity.
    !!! hascost "IRI of 'hasCost' in <code>triples</code>.  Used for associating a"
        user-defined cost or cost function with instantiation of a
        property.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Input</code></td>
      <td><p>A MappingStep instance.  This is a root of a nested tree of
MappingStep instances providing an (efficient) internal description
of all possible mapping routes from <code>sources</code> to <code>target</code>.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tripper/mappings/mappings.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mapping_routes</span><span class="p">(</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sources</span><span class="p">:</span> <span class="s2">&quot;Union[Dict[str, Union[None, Value]], Sequence[str]]&quot;</span><span class="p">,</span>
    <span class="n">triplestore</span><span class="p">:</span> <span class="s2">&quot;Triplestore&quot;</span><span class="p">,</span>
    <span class="n">function_repo</span><span class="p">:</span> <span class="s2">&quot;Optional[dict]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">function_mappers</span><span class="p">:</span> <span class="s2">&quot;Union[str, Sequence[Callable]]&quot;</span> <span class="o">=</span> <span class="p">(</span><span class="n">emmo_mapper</span><span class="p">,</span> <span class="n">fno_mapper</span><span class="p">),</span>
    <span class="n">default_costs</span><span class="p">:</span> <span class="s2">&quot;Tuple&quot;</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;mapsTo&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;instanceOf&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;subClassOf&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">value_class</span><span class="p">:</span> <span class="s2">&quot;Optional[Type[Value]]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mappingstep_class</span><span class="p">:</span> <span class="s2">&quot;Optional[Type[MappingStep]]&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mapsTo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MAP</span><span class="o">.</span><span class="n">mapsTo</span><span class="p">,</span>
    <span class="n">instanceOf</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DM</span><span class="o">.</span><span class="n">instanceOf</span><span class="p">,</span>
    <span class="n">subClassOf</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RDFS</span><span class="o">.</span><span class="n">subClassOf</span><span class="p">,</span>
    <span class="c1"># description: str = DCTERMS.description,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RDFS</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
    <span class="n">hasUnit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DM</span><span class="o">.</span><span class="n">hasUnit</span><span class="p">,</span>
    <span class="n">hasCost</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DM</span><span class="o">.</span><span class="n">hasCost</span><span class="p">,</span>  <span class="c1"># TODO - add hasCost to the DM ontology</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Input</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find routes of mappings from any source in `sources` to `target`.</span>

<span class="sd">    This implementation supports functions (using FnO) and subclass</span>
<span class="sd">    relations.  It also correctly handles transitivity of `mapsTo` and</span>
<span class="sd">    `subClassOf` relations.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        target: IRI of the target in `triplestore`.</span>
<span class="sd">        sources: Dict mapping source IRIs to source values or a sequence</span>
<span class="sd">            of source IRIs (with no explicit values).</span>
<span class="sd">        triplestore: Triplestore instance.</span>
<span class="sd">            It is safe to pass a generator expression too.</span>

<span class="sd">    Additional arguments for fine-grained tuning:</span>
<span class="sd">        function_repo: Dict mapping function IRIs to corresponding Python</span>
<span class="sd">            function.  Default is to use `triplestore.function_repo`.</span>
<span class="sd">        function_mappers: Name of mapping standard: &quot;emmo&quot; or &quot;fno&quot;.</span>
<span class="sd">            Alternatively, a sequence of mapping functions that takes</span>
<span class="sd">            `triplestore` as argument and return a dict mapping output IRIs</span>
<span class="sd">            to a list of `(function_iri, [input_iris, ...])` tuples.</span>
<span class="sd">        default_costs: A dict providing default costs of different types</span>
<span class="sd">            of mapping steps (&quot;function&quot;, &quot;mapsTo&quot;, &quot;instanceOf&quot;,</span>
<span class="sd">            &quot;subclassOf&quot;, and &quot;value&quot;).  These costs can be overridden with</span>
<span class="sd">            &#39;hasCost&#39; relations in the ontology.</span>
<span class="sd">        value_class: Optional `Value` subclass to use instead of `Value` when</span>
<span class="sd">            creating the returned mapping route.</span>
<span class="sd">        mappingstep_class: Optional `MappingStep` subclass to use instead of</span>
<span class="sd">            `MappingStep` when creating the returned mapping route.</span>
<span class="sd">        mapsTo: IRI of &#39;mapsTo&#39; in `triplestore`.</span>
<span class="sd">        instanceOf: IRI of &#39;instanceOf&#39; in `triplestore`.</span>
<span class="sd">        subClassOf: IRI of &#39;subClassOf&#39; in `triples`.  Set it to None if</span>
<span class="sd">            subclasses should not be considered.</span>
<span class="sd">        label: IRI of &#39;label&#39; in `triplestore`.  Used for naming function</span>
<span class="sd">            input parameters.  The default is to use rdfs:label.</span>
<span class="sd">        hasUnit: IRI of &#39;hasUnit&#39; in `triples`.  Can be used to explicit</span>
<span class="sd">            specify the unit of a quantity.</span>
<span class="sd">        hasCost: IRI of &#39;hasCost&#39; in `triples`.  Used for associating a</span>
<span class="sd">            user-defined cost or cost function with instantiation of a</span>
<span class="sd">            property.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A MappingStep instance.  This is a root of a nested tree of</span>
<span class="sd">        MappingStep instances providing an (efficient) internal description</span>
<span class="sd">        of all possible mapping routes from `sources` to `target`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=too-many-arguments,too-many-locals,too-many-statements</span>

    <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Value</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">{</span><span class="n">iri</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">iri</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">function_repo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">function_repo</span> <span class="o">=</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">function_repo</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function_mappers</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">fmd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;emmo&quot;</span><span class="p">:</span> <span class="n">emmo_mapper</span><span class="p">,</span> <span class="s2">&quot;fno&quot;</span><span class="p">:</span> <span class="n">fno_mapper</span><span class="p">}</span>
        <span class="n">function_mappers</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmd</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">function_mappers</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>

    <span class="n">default_costs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">default_costs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">value_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value_class</span> <span class="o">=</span> <span class="n">Value</span>

    <span class="k">if</span> <span class="n">mappingstep_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mappingstep_class</span> <span class="o">=</span> <span class="n">MappingStep</span>

    <span class="c1"># Create lookup tables for fast access to triplestore content</span>
    <span class="n">soMaps</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># (s, mapsTo, o)     ==&gt; soMaps[s]  -&gt; [o, ..]</span>
    <span class="n">osMaps</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># (o, mapsTo, s)     ==&gt; osMaps[o]  -&gt; [s, ..]</span>
    <span class="n">osSubcl</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># (o, subClassOf, s) ==&gt; osSubcl[o] -&gt; [s, ..]</span>
    <span class="n">soInst</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (s, instanceOf, o) ==&gt; soInst[s]  -&gt; o</span>
    <span class="n">osInst</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># (o, instanceOf, s) ==&gt; osInst[o]  -&gt; [s, ..]</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">mapsTo</span><span class="p">):</span>
        <span class="n">soMaps</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="n">osMaps</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">subClassOf</span><span class="p">):</span>
        <span class="n">osSubcl</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">instanceOf</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">soInst</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InconsistentTriplesError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The same individual can only relate to one datamodel &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;property via </span><span class="si">{</span><span class="n">instanceOf</span><span class="si">}</span><span class="s2"> relations.&quot;</span>
            <span class="p">)</span>
        <span class="n">soInst</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span>
        <span class="n">osInst</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">soName</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="n">soUnit</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">hasUnit</span><span class="p">))</span>
    <span class="n">soCost</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">triplestore</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">(</span><span class="n">hasCost</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getcost</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">stepname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the cost assigned to IRI `target` for a mapping step</span>
<span class="sd">        of type `stepname`.&quot;&quot;&quot;</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">soCost</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">default_costs</span><span class="p">[</span><span class="n">stepname</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">function_repo</span><span class="p">[</span><span class="n">cost</span><span class="p">]</span> <span class="k">if</span> <span class="n">cost</span> <span class="ow">in</span> <span class="n">function_repo</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">parse_literal</span><span class="p">(</span><span class="n">cost</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Walk backward in rdf graph from `node` to sources.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">addnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">steptype</span><span class="p">,</span> <span class="n">stepname</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">step</span><span class="o">.</span><span class="n">steptype</span> <span class="o">=</span> <span class="n">steptype</span>
            <span class="n">step</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">getcost</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">stepname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value_class</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">sources</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
                    <span class="n">unit</span><span class="o">=</span><span class="n">soUnit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
                    <span class="n">iri</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">property_iri</span><span class="o">=</span><span class="n">soInst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
                    <span class="n">cost</span><span class="o">=</span><span class="n">getcost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">step</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">soName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prevstep</span> <span class="o">=</span> <span class="n">mappingstep_class</span><span class="p">(</span>
                    <span class="n">output_iri</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">output_unit</span><span class="o">=</span><span class="n">soUnit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>
                    <span class="n">triplestore</span><span class="o">=</span><span class="n">triplestore</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">step</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">prevstep</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">soName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
                <span class="n">walk</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">prevstep</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">osInst</span><span class="p">[</span><span class="n">target</span><span class="p">]:</span>
            <span class="n">addnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">StepType</span><span class="o">.</span><span class="n">INV_INSTANCEOF</span><span class="p">,</span> <span class="s2">&quot;instanceOf&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">soMaps</span><span class="p">[</span><span class="n">target</span><span class="p">]:</span>
            <span class="n">addnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">StepType</span><span class="o">.</span><span class="n">MAPSTO</span><span class="p">,</span> <span class="s2">&quot;mapsTo&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">osMaps</span><span class="p">[</span><span class="n">target</span><span class="p">]:</span>
            <span class="n">addnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">StepType</span><span class="o">.</span><span class="n">INV_MAPSTO</span><span class="p">,</span> <span class="s2">&quot;mapsTo&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">osSubcl</span><span class="p">[</span><span class="n">target</span><span class="p">]:</span>
            <span class="n">addnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">StepType</span><span class="o">.</span><span class="n">INV_SUBCLASSOF</span><span class="p">,</span> <span class="s2">&quot;subClassOf&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fmap</span> <span class="ow">in</span> <span class="n">function_mappers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">input_iris</span> <span class="ow">in</span> <span class="n">fmap</span><span class="p">(</span><span class="n">triplestore</span><span class="p">)[</span><span class="n">target</span><span class="p">]:</span>
                <span class="n">step</span><span class="o">.</span><span class="n">steptype</span> <span class="o">=</span> <span class="n">StepType</span><span class="o">.</span><span class="n">FUNCTION</span>
                <span class="n">step</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">getcost</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span>
                <span class="n">step</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function_repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="n">step</span><span class="o">.</span><span class="n">join_mode</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">input_iri</span> <span class="ow">in</span> <span class="n">input_iris</span><span class="p">:</span>
                    <span class="n">step0</span> <span class="o">=</span> <span class="n">mappingstep_class</span><span class="p">(</span>
                        <span class="n">output_iri</span><span class="o">=</span><span class="n">input_iri</span><span class="p">,</span>
                        <span class="n">output_unit</span><span class="o">=</span><span class="n">soUnit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">input_iri</span><span class="p">),</span>
                        <span class="n">triplestore</span><span class="o">=</span><span class="n">triplestore</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">step</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">step0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">soName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">input_iri</span><span class="p">))</span>
                    <span class="n">walk</span><span class="p">(</span><span class="n">input_iri</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">step0</span><span class="p">)</span>
                <span class="n">step</span><span class="o">.</span><span class="n">join_input</span><span class="p">()</span>

    <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">mappingstep_class</span><span class="p">(</span>
        <span class="n">output_iri</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
        <span class="n">output_unit</span><span class="o">=</span><span class="n">soUnit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">),</span>
        <span class="n">triplestore</span><span class="o">=</span><span class="n">triplestore</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">soInst</span><span class="p">:</span>
        <span class="c1"># It is only initially we want to follow instanceOf in forward</span>
        <span class="c1"># direction.  Later on we will only follow mapsTo and instanceOf in</span>
        <span class="c1"># backward direction.</span>
        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>  <span class="c1"># do we really wan&#39;t this?  Yes, I think so...</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">soInst</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
        <span class="n">step</span><span class="o">.</span><span class="n">steptype</span> <span class="o">=</span> <span class="n">StepType</span><span class="o">.</span><span class="n">INSTANCEOF</span>
        <span class="n">step</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">getcost</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;instanceOf&quot;</span><span class="p">)</span>
        <span class="n">step0</span> <span class="o">=</span> <span class="n">mappingstep_class</span><span class="p">(</span>
            <span class="n">output_iri</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
            <span class="n">output_unit</span><span class="o">=</span><span class="n">soUnit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source</span><span class="p">),</span>
            <span class="n">triplestore</span><span class="o">=</span><span class="n">triplestore</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">step</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">step0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">soName</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">step0</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">source</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">soMaps</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingRelationError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Missing &quot;mapsTo&quot; relation on: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">walk</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">step</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 SINTEF
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/EMMC-ASBL" target="_blank" rel="noopener" title="EMMC-ASBL on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.top", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6df46069.min.js"></script>
      
    
  </body>
</html>